{"version":3,"file":"482.335b0e59.chunk.js","mappings":"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","sources":["webpack://@app/client/./src/lib/hooks/use-render-order.tsx","webpack://@app/client/./src/lib/components/surface.tsx","webpack://@app/client/./src/lib/hooks/use-render-key.tsx","webpack://@app/client/./src/examples/layout.tsx"],"sourcesContent":["import React from \"react\";\n\nlet lastRenderOrder = -1;\n\nexport default function useRenderOrder() {\n  return React.useMemo(() => {\n    return ++lastRenderOrder;\n  }, []);\n}\n","import React from \"react\";\nimport * as THREE from \"three\";\nimport useRenderOrder from \"@/lib/hooks/use-render-order\";\nimport useRenderKey from \"@/lib/hooks/use-render-key\";\nimport { useThree } from \"@react-three/fiber\";\n\nenum Orientation {\n  landscape = \"landscape\",\n  portrait = \"portrait\",\n}\n\ntype Props = {\n  children?: React.ReactNode;\n  width?: number;\n  height?: number;\n  backgroundColor?: THREE.ColorRepresentation;\n  backgroundImage?: string;\n  backgroundSize?: \"cover\" | \"contain\";\n  tint?: THREE.ColorRepresentation;\n  zIndex?: number;\n};\n\nexport default function Surface({\n  children,\n  width = 1,\n  height = 1,\n  backgroundColor = \"black\",\n  backgroundImage,\n  backgroundSize,\n  tint,\n  zIndex = 0,\n}: Props) {\n  const gl = useThree((state) => state.gl);\n\n  // Set geometry size from `width` and `height` props\n  const size = React.useMemo(() => {\n    return { width, height };\n  }, [width, height]);\n\n  // Set material texture from `backgroundImage` prop\n  const [texture, setTexture] = React.useState<THREE.Texture>(undefined);\n  React.useMemo(() => {\n    if (backgroundImage === undefined) return;\n    new THREE.TextureLoader().loadAsync(backgroundImage).then(setTexture);\n  }, [backgroundImage]);\n\n  // Set texture `anisotropy` to max available (prevents blurriness)\n  // when viewing at an angle\n  React.useMemo(() => {\n    if (texture === undefined) return;\n    texture.anisotropy = gl.capabilities.getMaxAnisotropy();\n  }, [texture, gl]);\n\n  const [surfaceRatio, imageRatioX, imageRatioY] = React.useMemo(() => {\n    const surfaceRatio = size.width / size.height;\n    if (texture === undefined) {\n      return [surfaceRatio, surfaceRatio, surfaceRatio];\n    }\n    const imageRatioX = texture.image.width / texture.image.height;\n    const imageRatioY = texture.image.height / texture.image.width;\n    return [surfaceRatio, imageRatioX, imageRatioY];\n  }, [texture, size]);\n\n  const planes = React.useMemo(() => {\n    const plane = new THREE.Plane(new THREE.Vector3(), 1);\n    return [plane.clone(), plane.clone(), plane.clone(), plane.clone()];\n  }, []);\n\n  const [textureSize, textureClippingPlanes] = React.useMemo(() => {\n    if (texture === undefined) return [size, planes];\n\n    const newSize = { ...size };\n\n    // @todo find a way to simplify this\n\n    if (backgroundSize === \"contain\") {\n      if (imageRatioX >= surfaceRatio) {\n        newSize.width = size.width;\n        newSize.height = newSize.width * imageRatioY;\n      } else {\n        newSize.height = size.height;\n        newSize.width = newSize.height * imageRatioX;\n      }\n    }\n\n    if (backgroundSize === \"cover\") {\n      if (imageRatioX >= surfaceRatio) {\n        newSize.height = size.height;\n        newSize.width = newSize.height * imageRatioX;\n      } else {\n        newSize.width = size.width;\n        newSize.height = newSize.width * imageRatioY;\n      }\n    }\n\n    planes[0].set(new THREE.Vector3(0, -1, 0), size.height * 0.5);\n    planes[1].set(new THREE.Vector3(1, 0, 0), size.width * 0.5);\n    planes[2].set(new THREE.Vector3(0, 1, 0), size.height * 0.5);\n    planes[3].set(new THREE.Vector3(-1, 0, 0), size.width * 0.5);\n\n    return [newSize, planes];\n  }, [\n    planes,\n    texture,\n    size,\n    backgroundSize,\n    imageRatioX,\n    imageRatioY,\n    surfaceRatio,\n  ]);\n\n  const renderOrder = useRenderOrder();\n  const key = useRenderKey([texture, tint]);\n\n  return (\n    <group key={key}>\n      <mesh renderOrder={renderOrder + zIndex}>\n        <planeBufferGeometry args={[size.width, size.height]} />\n        <meshBasicMaterial\n          color={backgroundColor}\n          transparent={true}\n          depthWrite={false}\n        />\n      </mesh>\n      <mesh visible={texture !== undefined} renderOrder={renderOrder + zIndex}>\n        <planeBufferGeometry args={[textureSize.width, textureSize.height]} />\n        <meshBasicMaterial\n          map={texture}\n          transparent={true}\n          depthWrite={false}\n          clippingPlanes={textureClippingPlanes}\n        />\n      </mesh>\n      {children}\n    </group>\n  );\n}\n","import React from \"react\";\n\nexport default function useRenderKey(deps: React.DependencyList | undefined) {\n  const lastKey = React.useRef(0);\n\n  return React.useMemo(() => {\n    let key = ++lastKey.current;\n    if (key > 1000) {\n      key = 0;\n      lastKey.current = key;\n    }\n    return key;\n  }, deps);\n}\n","import React from \"react\";\nimport { Canvas } from \"@react-three/fiber\";\nimport { OrbitControls, PerspectiveCamera } from \"@react-three/drei\";\nimport Surface from \"@/lib/components/surface\";\n\nexport default function Layout() {\n  return (\n    <Canvas flat linear gl={{ localClippingEnabled: true }}>\n      {/** Cameras, controls and lights */}\n      <PerspectiveCamera makeDefault position={[0, 0, 5]} />\n      <OrbitControls makeDefault />\n      <ambientLight />\n\n      {/** Example */}\n\n      <Surface backgroundColor=\"crimson\" width={3} height={3}>\n        <Surface\n          width={1.5}\n          height={1.5}\n          backgroundSize=\"cover\"\n          backgroundColor=\"green\"\n          backgroundImage=\"./assets/images/robot.png\"\n        />\n      </Surface>\n    </Canvas>\n  );\n}\n"],"names":["lastRenderOrder","Orientation","Surface","children","width","height","backgroundColor","backgroundImage","backgroundSize","tint","zIndex","gl","useThree","state","size","React","texture","setTexture","undefined","THREE","loadAsync","then","anisotropy","capabilities","getMaxAnisotropy","surfaceRatio","imageRatioX","imageRatioY","image","planes","plane","clone","textureSize","textureClippingPlanes","newSize","set","renderOrder","key","deps","lastKey","current","useRenderKey","args","color","transparent","depthWrite","visible","map","clippingPlanes","Layout","flat","linear","localClippingEnabled","PerspectiveCamera","makeDefault","position","OrbitControls"],"sourceRoot":""}